<div class="recipes-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>üìñ Mes Recettes</h1>
      <p class="subtitle">D√©couvrez et cuisinez vos recettes pr√©f√©r√©es</p>
    </div>
  </div>

  <!-- Search Section -->
  <div class="search-section">
    <input
      type="text"
      class="search-input"
      placeholder="üîç Rechercher une recette..."
      [(ngModel)]="searchQuery"
      (input)="onSearch()"
    />
  </div>

  <!-- Recipes Display -->
  <div class="recipes-container">
    <!-- Recipes R√©alisables Section -->
    @if ((filteredRecipes | filterByStatus: true).length > 0) {
      <section class="recipes-section ready-section">
        <div class="section-header">
          <h2>‚úÖ Recettes R√©alisables</h2>
          <span class="count-badge">{{ (filteredRecipes | filterByStatus: true).length }}</span>
        </div>

        <div class="recipes-grid">
          @for (recipe of (filteredRecipes | filterByStatus: true) | sliceByExpiry; track recipe.id) {
            <mat-card [class.recipe-card]="true" [class.has-expiring]="recipe.hasExpiringIngredients">
              <!-- Expiring Badge -->
              @if (recipe.hasExpiringIngredients) {
                <div class="expiring-badge">
                  ‚è∞ √Ä utiliser rapidement
                </div>
              }

              <!-- Recipe Image -->
              <div class="recipe-image">
                @if (recipe.image) {
                  <img [src]="recipe.image" alt="{{ recipe.name }}" class="recipe-photo" />
                } @else {
                  <div class="recipe-placeholder">
                    <span class="placeholder-icon">üì∏</span>
                  </div>
                }
              </div>

              <!-- Recipe Header -->
              <mat-card-header>
                <div class="header-top">
                  <h3>{{ recipe.name }}</h3>
                  <span class="category-badge">{{ recipe.category }}</span>
                </div>
                <div class="difficulty-time">
                  <span class="difficulty" [class]="'difficulty-' + recipe.difficulty">
                    {{ getDifficultyLabel(recipe.difficulty) }}
                  </span>
                  <span class="time">‚è±Ô∏è {{ recipe.prepTime + recipe.cookTime }}min</span>
                </div>
              </mat-card-header>

              <!-- Recipe Content -->
              <mat-card-content>
                <p class="recipe-description">{{ recipe.description }}</p>

                <!-- Expiring Ingredients Alert -->
                @if (recipe.expiringIngredients && recipe.expiringIngredients.length > 0) {
                  <div class="expiring-alert">
                    <strong>‚è∞ √Ä utiliser rapidement :</strong>
                    <ul class="expiring-list">
                      @for (exp of recipe.expiringIngredients; track exp.ingredientId) {
                        <li>
                          {{ exp.ingredientName }}
                          <span class="expiry-days" [class.urgent]="exp.daysToExpiry === 1">
                            ({{ exp.daysToExpiry === 1 ? "demain" : exp.daysToExpiry + " jours" }})
                          </span>
                        </li>
                      }
                    </ul>
                  </div>
                }
              </mat-card-content>

              <!-- Recipe Actions -->
              <mat-card-actions>
                <button mat-raised-button color="primary" (click)="viewRecipe(recipe)">
                  <mat-icon>visibility</mat-icon>
                  Voir la recette
                </button>
              </mat-card-actions>
            </mat-card>
          }
        </div>
      </section>
    }

    <!-- Recipes Non-R√©alisables Section -->
    @if ((filteredRecipes | filterByStatus: false).length > 0) {
      <section class="recipes-section unavailable-section">
        <div class="section-header">
          <h2>‚ùå Recettes Non R√©alisables</h2>
          <span class="count-badge">{{ (filteredRecipes | filterByStatus: false).length }}</span>
        </div>

        <div class="recipes-grid">
          @for (recipe of (filteredRecipes | filterByStatus: false); track recipe.id) {
            <mat-card [class.recipe-card]="true" [class.disabled]="true">
              <!-- Recipe Image (Grayed Out) -->
              <div class="recipe-image disabled-overlay">
                @if (recipe.image) {
                  <img [src]="recipe.image" alt="{{ recipe.name }}" class="recipe-photo" />
                } @else {
                  <div class="recipe-placeholder">
                    <span class="placeholder-icon">üì∏</span>
                  </div>
                }
                <div class="overlay-text">üîí Ingr√©dients manquants</div>
              </div>

              <!-- Recipe Header -->
              <mat-card-header>
                <div class="header-top">
                  <h3>{{ recipe.name }}</h3>
                  <span class="category-badge">{{ recipe.category }}</span>
                </div>
                <div class="difficulty-time">
                  <span class="difficulty" [class]="'difficulty-' + recipe.difficulty">
                    {{ getDifficultyLabel(recipe.difficulty) }}
                  </span>
                  <span class="time">‚è±Ô∏è {{ recipe.prepTime + recipe.cookTime }}min</span>
                </div>
              </mat-card-header>

              <!-- Recipe Content -->
              <mat-card-content>
                <p class="recipe-description">{{ recipe.description }}</p>

                <!-- Missing Ingredients Alert -->
                @if (recipe.missingIngredients && recipe.missingIngredients.length > 0) {
                  <div class="missing-alert">
                    <strong>üõí Ingr√©dients manquants :</strong>
                    <ul class="missing-list">
                      @for (missing of recipe.missingIngredients; track missing.ingredientId) {
                        <li>
                          <span class="ingredient-name">{{ missing.ingredientName }}</span>
                          <span class="missing-qty">
                            Manque : {{ missing.missing }} {{ missing.unit }}
                          </span>
                          <span class="available-qty">
                            (Vous en avez : {{ missing.available }} {{ missing.unit }})
                          </span>
                        </li>
                      }
                    </ul>
                  </div>
                }
              </mat-card-content>

              <!-- Recipe Actions (Disabled) -->
              <mat-card-actions>
                <button mat-raised-button color="primary" (click)="viewRecipe(recipe)" disabled>
                  <mat-icon>visibility</mat-icon>
                  Voir la recette
                </button>
              </mat-card-actions>
            </mat-card>
          }
        </div>
      </section>
    }

    <!-- Empty State -->
    @if (filteredRecipes.length === 0) {
      <div class="empty-state">
        <div class="empty-icon">üì≠</div>
        <h2>Aucune recette trouv√©e</h2>
        <p>{{ searchQuery() ? 'Essayez une autre recherche' : 'Commencez par cr√©er votre premi√®re recette !' }}</p>
      </div>
    }
  </div>
</div>
